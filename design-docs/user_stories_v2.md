# 相次相続控除額 計算シミュレーター（家系図表示版）
# ユーザーストーリー（Gherkin形式）v2.0

**文書バージョン:** 2.0  
**作成日:** 2025年6月18日  
**作成者:** Manus AI

## 1. アプリケーション初期表示

### シナリオ: ユーザーがアプリケーションを初めて開いたとき
```gherkin
機能: アプリケーション初期表示

シナリオ: ユーザーがアプリケーションを初めて開く
  前提 ユーザーがブラウザでアプリケーションのURLにアクセスする
  ならば 「相次相続控除額 計算シミュレーター」というタイトルが表示されること
  かつ 相次相続控除の概要説明が表示されること
  かつ 日付入力フォームが表示されること
  かつ 基本的な家系図が表示されること
  かつ すべての入力フィールドが初期値（空または0）で表示されること
  かつ 計算結果が0円と表示されること
```

### シナリオ: ユーザーが画面サイズの異なるデバイスでアクセスしたとき
```gherkin
機能: レスポンシブデザイン対応

シナリオ: ユーザーがデスクトップでアクセスする
  前提 ユーザーがデスクトップブラウザ（画面幅1200px以上）でアクセスする
  ならば 入力フォームと家系図が横並びで表示されること

シナリオ: ユーザーがタブレットでアクセスする
  前提 ユーザーがタブレット（画面幅768px〜1199px）でアクセスする
  ならば 入力フォームと家系図が縦並びで表示されること

シナリオ: ユーザーがスマートフォンでアクセスする
  前提 ユーザーがスマートフォン（画面幅767px以下）でアクセスする
  ならば 入力フォームと家系図がタブ切り替え式で表示されること
  かつ 「入力」タブがデフォルトで選択されていること
```

## 2. 日付入力と経過年数計算

### シナリオ: ユーザーが相続日を入力したとき
```gherkin
機能: 相続日入力と経過年数自動計算

シナリオ: ユーザーが両方の相続日を西暦で入力する
  前提 ユーザーがアプリケーションを開いている
  もし 「1回目の相続日（西暦）」に「2016-03-26」と入力する
  かつ 「2回目の相続日（西暦）」に「2021-05-04」と入力する
  ならば 「前回の相続からの経過年数」フィールドに「5」と表示されること
  かつ 家系図上の該当する人物に死亡日が表示されること

シナリオ: ユーザーが両方の相続日を和暦で入力する
  前提 ユーザーがアプリケーションを開いている
  もし 「1回目の相続日（和暦）」に「平成28年3月26日」と入力する
  かつ 「2回目の相続日（和暦）」に「令和3年5月4日」と入力する
  ならば 「前回の相続からの経過年数」フィールドに「5」と表示されること
  かつ 家系図上の該当する人物に死亡日が表示されること

シナリオ: 1年未満の経過期間の切り捨て処理
  前提 ユーザーがアプリケーションを開いている
  もし 「1回目の相続日」に「2020-06-01」と入力する
  かつ 「2回目の相続日」に「2021-05-31」と入力する
  ならば 「前回の相続からの経過年数」フィールドに「0」と表示されること
  かつ 「1年未満は切り捨てられます」という注意書きがハイライトされること

シナリオ: 10年以上経過している場合
  前提 ユーザーがアプリケーションを開いている
  もし 「1回目の相続日」に「2010-01-01」と入力する
  かつ 「2回目の相続日」に「2021-01-01」と入力する
  ならば 「前回の相続からの経過年数」フィールドに「11」と表示されること
  かつ 「10年を超えているため、相次相続控除は適用されません」という警告が表示されること
```

### シナリオ: 日付入力の検証
```gherkin
機能: 日付入力の検証

シナリオ: 無効な日付形式の入力
  前提 ユーザーがアプリケーションを開いている
  もし 「1回目の相続日」に「不正な日付」と入力する
  ならば 「有効な日付を入力してください」というエラーメッセージが表示されること

シナリオ: 未来の日付の入力
  前提 ユーザーがアプリケーションを開いている
  もし 「1回目の相続日」に未来の日付を入力する
  ならば 「過去の日付を入力してください」というエラーメッセージが表示されること

シナリオ: 2回目の相続日が1回目より前の場合
  前提 ユーザーがアプリケーションを開いている
  もし 「1回目の相続日」に「2020-01-01」と入力する
  かつ 「2回目の相続日」に「2019-01-01」と入力する
  ならば 「2回目の相続日は1回目の相続日より後である必要があります」というエラーメッセージが表示されること
```

## 3. 家系図表示と操作

### シナリオ: 家系図の基本表示
```gherkin
機能: 家系図表示

シナリオ: 初期家系図の表示
  前提 ユーザーがアプリケーションを開いている
  ならば 3世代の基本家系図が表示されること
  かつ 1世代目に祖父母が表示されること
  かつ 2世代目に父母が表示されること
  かつ 3世代目に子（相続人）が表示されること

シナリオ: 性別による色分け表示
  前提 ユーザーがアプリケーションを開いている
  ならば 男性は青系色のアイコンで表示されること
  かつ 女性は赤系色のアイコンで表示されること

シナリオ: 死亡状態の表示
  前提 ユーザーが相続日を入力している
  ならば 死亡した人物のアイコンには「×」マークが表示されること
  かつ 死亡日が該当する人物の下に表示されること
```

### シナリオ: 家系図の操作
```gherkin
機能: 家系図操作

シナリオ: 家系図の拡大縮小
  前提 ユーザーがアプリケーションを開いている
  もし 拡大ボタンをクリックする
  ならば 家系図が拡大表示されること
  もし 縮小ボタンをクリックする
  ならば 家系図が縮小表示されること

シナリオ: 人物情報の詳細表示
  前提 ユーザーがアプリケーションを開いている
  もし 家系図上の人物アイコンをクリックする
  ならば その人物の詳細情報がポップアップ表示されること
  かつ 名前、続柄、相続状態などの情報が表示されること

シナリオ: 相続控除額の表示切替
  前提 ユーザーが必要な情報を入力し計算が完了している
  もし 「控除額表示」トグルをオンにする
  ならば 各法定相続人の相次相続控除額が家系図上に表示されること
  もし 「控除額表示」トグルをオフにする
  ならば 相次相続控除額の表示が非表示になること
```

## 4. 相続人情報の入力

### シナリオ: 相続人の基本情報入力
```gherkin
機能: 相続人情報入力

シナリオ: 相続人の名前入力
  前提 ユーザーがアプリケーションを開いている
  もし 「長男」の名前欄に「山田太郎」と入力する
  ならば 家系図上の長男アイコンの下に「山田太郎」と表示されること

シナリオ: 相続人の続柄選択
  前提 ユーザーがアプリケーションを開いている
  もし 相続人の続柄ドロップダウンから「配偶者」を選択する
  ならば 家系図上でその人物が配偶者として表示されること
  かつ 適切な位置に配置されること

シナリオ: 相続人のステータス選択
  前提 ユーザーがアプリケーションを開いている
  もし 相続人のステータスドロップダウンから「相続放棄」を選択する
  ならば 家系図上でその人物が相続放棄状態として表示されること
  かつ 相次相続控除額の計算対象から除外されること
```

### シナリオ: 相続人の財産情報入力
```gherkin
機能: 相続財産情報入力

シナリオ: 相続財産総額の入力
  前提 ユーザーがアプリケーションを開いている
  もし 「C: 今回の相続財産の総額」に「100000000」と入力する
  ならば 入力欄に「100,000,000」と3桁区切りで表示されること
  かつ 計算に「100000000」の値が使用されること

シナリオ: 各相続人の取得財産額入力
  前提 ユーザーがアプリケーションを開いている
  もし 「長男」の「D: 取得した財産の価額」に「50000000」と入力する
  かつ 「二男」の「D: 取得した財産の価額」に「30000000」と入力する
  かつ 「三男」の「D: 取得した財産の価額」に「20000000」と入力する
  ならば 各入力欄に3桁区切りで表示されること
  かつ 各相続人の取得財産額の合計が「C: 今回の相続財産の総額」と一致するか検証されること

シナリオ: 被相続人の相続税情報入力
  前提 ユーザーがアプリケーションを開いている
  もし 「A: 前回の相続で納めた相続税額」に「10000000」と入力する
  かつ 「B: 前回に取得した財産の価額」に「80000000」と入力する
  ならば 各入力欄に3桁区切りで表示されること
  かつ 計算に正しい値が使用されること
```

## 5. 相次相続控除額の計算

### シナリオ: 基本的な計算
```gherkin
機能: 相次相続控除額計算

シナリオ: すべての必須情報を入力して計算
  前提 ユーザーがアプリケーションを開いている
  もし 「1回目の相続日」に「2016-03-26」と入力する
  かつ 「2回目の相続日」に「2021-05-04」と入力する
  かつ 「A: 前回の相続で納めた相続税額」に「17000000」と入力する
  かつ 「B: 前回に取得した財産の価額」に「82000000」と入力する
  かつ 「C: 今回の相続財産の総額」に「484000000」と入力する
  かつ 「長男」の「D: 取得した財産の価額」に「280000000」と入力する
  かつ 「長男」のステータスを「法定相続人」に設定する
  ならば 「長男」の相次相続控除額が「4917250」と計算されること
  かつ 家系図上に「長男」の相次相続控除額が表示されること

シナリオ: 複数の法定相続人がいる場合の計算
  前提 ユーザーがアプリケーションを開いている
  もし 必要な日付情報とA, B, C値を入力する
  かつ 「長男」の「D: 取得した財産の価額」に「200000000」と入力し、ステータスを「法定相続人」に設定する
  かつ 「二男」の「D: 取得した財産の価額」に「150000000」と入力し、ステータスを「法定相続人」に設定する
  かつ 「三男」の「D: 取得した財産の価額」に「134000000」と入力し、ステータスを「法定相続人」に設定する
  ならば 各相続人の相次相続控除額が正しく計算されること
  かつ 家系図上に各相続人の相次相続控除額が表示されること
  かつ 総控除額が表示されること
```

### シナリオ: 特殊ケースの計算
```gherkin
機能: 特殊ケースの計算処理

シナリオ: 相続人が一人だけの場合
  前提 ユーザーがアプリケーションを開いている
  もし 必要な日付情報とA, B, C値を入力する
  かつ 「配偶者」の「D: 取得した財産の価額」にC値と同じ額を入力し、ステータスを「法定相続人」に設定する
  かつ 他の相続人のステータスを「相続放棄」に設定する
  ならば 「配偶者」の相次相続控除額が正しく計算されること
  かつ 総控除額が「配偶者」の控除額と一致すること

シナリオ: 法定相続人がいない場合
  前提 ユーザーがアプリケーションを開いている
  もし 必要な日付情報とA, B, C値を入力する
  かつ すべての相続人のステータスを「法定相続人」以外に設定する
  ならば 「法定相続人がいないため、相次相続控除は適用されません」という警告が表示されること
  かつ 総控除額が「0」と表示されること

シナリオ: 経過年数が10年の場合
  前提 ユーザーがアプリケーションを開いている
  もし 「1回目の相続日」と「2回目の相続日」の差が丁度10年になるよう入力する
  かつ 他の必要情報を入力する
  ならば 「E: 前回の相続からの経過年数」が「10」と表示されること
  かつ 相次相続控除額が「0」と計算されること
  かつ 「10年経過しているため、相次相続控除は適用されません」という説明が表示されること
```

## 6. 入力値の検証

### シナリオ: 数値入力の検証
```gherkin
機能: 数値入力検証

シナリオ: 負の値の入力
  前提 ユーザーがアプリケーションを開いている
  もし 「A: 前回の相続で納めた相続税額」に「-10000」と入力する
  ならば 「0以上の値を入力してください」というエラーメッセージが表示されること
  かつ 入力値が自動的に「0」に修正されること

シナリオ: 数値以外の入力
  前提 ユーザーがアプリケーションを開いている
  もし 「C: 今回の相続財産の総額」に「abc」と入力する
  ならば 「数値を入力してください」というエラーメッセージが表示されること
  かつ 入力が受け付けられないこと

シナリオ: 取得財産額の合計検証
  前提 ユーザーがアプリケーションを開いている
  もし 「C: 今回の相続財産の総額」に「100000000」と入力する
  かつ すべての相続人の「D: 取得した財産の価額」の合計が「120000000」になるよう入力する
  ならば 「取得財産額の合計が相続財産総額を超えています」という警告が表示されること
```

### シナリオ: 必須項目の検証
```gherkin
機能: 必須項目検証

シナリオ: 必須項目が未入力の場合
  前提 ユーザーがアプリケーションを開いている
  もし 「A: 前回の相続で納めた相続税額」を空のままにする
  かつ 他の必須項目を入力する
  かつ 計算実行ボタンをクリックする
  ならば 「必須項目を入力してください」というエラーメッセージが表示されること
  かつ 未入力の項目がハイライト表示されること

シナリオ: ゼロ除算の防止
  前提 ユーザーがアプリケーションを開いている
  もし 「B: 前回に取得した財産の価額」に「0」と入力する
  かつ 計算実行ボタンをクリックする
  ならば 「ゼロ除算エラー: 前回に取得した財産の価額は0より大きい値を入力してください」というエラーメッセージが表示されること
```

## 7. データ管理機能

### シナリオ: データの一時保存
```gherkin
機能: データ一時保存

シナリオ: 入力データの自動保存
  前提 ユーザーがアプリケーションを開いている
  もし 各種情報を入力する
  かつ ブラウザを更新する
  ならば 前回入力した情報が保持されていること

シナリオ: データのリセット
  前提 ユーザーが情報を入力している
  もし 「リセット」ボタンをクリックする
  かつ 確認ダイアログで「はい」を選択する
  ならば すべての入力フィールドが初期値にリセットされること
  かつ 家系図が初期状態に戻ること
```

### シナリオ: データのエクスポート/インポート
```gherkin
機能: データエクスポート/インポート

シナリオ: データのJSONエクスポート
  前提 ユーザーが情報を入力している
  もし 「エクスポート」ボタンをクリックする
  ならば 入力データがJSONファイルとしてダウンロードされること

シナリオ: データのJSONインポート
  前提 ユーザーがアプリケーションを開いている
  もし 「インポート」ボタンをクリックする
  かつ 有効なJSONファイルを選択する
  ならば インポートしたデータが各フィールドに反映されること
  かつ 家系図が更新されること
  かつ 相次相続控除額が再計算されること
```

## 8. ヘルプ機能

### シナリオ: 説明表示
```gherkin
機能: ヘルプ機能

シナリオ: 項目説明の表示
  前提 ユーザーがアプリケーションを開いている
  もし 入力項目の横にある「?」アイコンにマウスオーバーする
  ならば その項目の詳細説明がツールチップとして表示されること

シナリオ: 相次相続控除の概要表示
  前提 ユーザーがアプリケーションを開いている
  もし 「相次相続控除とは？」セクションを展開する
  ならば 相次相続控除の概要と適用条件が表示されること
  かつ 計算式の説明が表示されること

シナリオ: 計算例の表示
  前提 ユーザーがアプリケーションを開いている
  もし 「計算例を見る」ボタンをクリックする
  ならば 具体的な計算例とその解説が表示されること
```

## 9. アクセシビリティ

### シナリオ: キーボード操作
```gherkin
機能: キーボードアクセシビリティ

シナリオ: キーボードでのフォーム操作
  前提 ユーザーがアプリケーションを開いている
  もし キーボードのTabキーを使って入力フィールド間を移動する
  ならば フォーカスが論理的な順序で移動すること
  かつ 現在フォーカスされている要素が視覚的に明示されること

シナリオ: キーボードでの家系図操作
  前提 ユーザーがアプリケーションを開いている
  もし キーボードのTabキーで家系図の人物にフォーカスする
  かつ Enterキーを押す
  ならば その人物の詳細情報が表示されること
```

### シナリオ: スクリーンリーダー対応
```gherkin
機能: スクリーンリーダー対応

シナリオ: 家系図の音声読み上げ
  前提 ユーザーがスクリーンリーダーを使用している
  もし 家系図にフォーカスする
  ならば 家系図の構造と各人物の関係性が適切に読み上げられること

シナリオ: 計算結果の音声通知
  前提 ユーザーがスクリーンリーダーを使用している
  もし 計算が完了する
  ならば 計算結果が適切に通知されること
```

## 10. 印刷機能

### シナリオ: 印刷レイアウト
```gherkin
機能: 印刷機能

シナリオ: 計算結果の印刷
  前提 ユーザーが計算を完了している
  もし 「印刷」ボタンをクリックする
  ならば 印刷用レイアウトが表示されること
  かつ 家系図と計算結果が適切に配置されていること
  かつ 入力値の一覧が表示されていること

シナリオ: 印刷プレビュー
  前提 ユーザーが計算を完了している
  もし 「印刷プレビュー」ボタンをクリックする
  ならば 印刷イメージがプレビュー表示されること
  かつ プレビュー画面で印刷設定を変更できること
```
