# 製品要求仕様書: 相次相続シミュレーター v3

## 1. 概要

本ドキュメントは、相次相続に特化した税額控除計算シミュレーターの要件を定義する。ユーザーが手書きのメモで示したUI/UXに基づき、複雑な相次相続の計算を直感的かつ簡単に行えるようにすることを目的とする。

## 2. 背景と目的

現行の相続税シミュレーターは一般的な相続計算には対応しているが、10年以内に2回以上の相続が発生する「相次相続」のケースには十分に対応できていない。相次相続は、短期間に複数回の相続税が課されることで遺族の負担が過重になることを防ぐため、特別な税額控除が認められている。

この新機能は、ユーザーが相次相続の対象となるかどうかを判断し、控除額を正確にシミュレーションすることで、適切な納税計画を立てる手助けをすることを目的とする。

## 3. ターゲットユーザー

- 相次相続が発生した、または発生する可能性のある個人
- 税理士、ファイナンシャルプランナーなどの専門家
- 相続について学習している学生や一般の人々

## 4. 機能要件

### 4.1. UIコンポーネント

手書きの図に基づき、以下の3つの主要なセクションで構成される。

- **第1次相続セクション（左）**
    - 前回の被相続人の氏名入力フィールド
    - 前回の相続における死亡日入力フィールド

- **第2次相続セクション（中央）**
    - 今回の被相続人の氏名入力フィールド
    - 今回の相続における死亡日入力フィールド
    - 第1次相続と第2次相続の間の期間（年数）を自動計算して表示 (E)
    - 前回の相続で今回の被相続人が取得した財産価額の入力フィールド (A)
    - 前回の相続で今回の被相続人が取得した負債価額の入力フィールド (B)
    - 今回の相続における課税対象となる純資産価額の合計入力フィールド (C)

- **相続人セクション（右）**
    - 各相続人の情報を入力するカード形式のUI
    - 相続人の氏名入力フィールド
    - 相続人のステータス選択（法定相続人, 相続放棄, 相続欠格, 法定外など）
    - 各相続人が取得した財産価額の入力フィールド (D)
    - 入力された値に基づき、各相続人の相次相続控除額を自動計算して表示
    - 「相続人を追加」ボタンによる入力フォームの動的な追加・削除機能

### 4.2. 計算ロジック

- **期間計算 (E):** 第1次相続の死亡日から第2次相続の死亡日までの期間を年単位で計算する（1年未満は切り捨て）。
- **相次相続控除額の計算:** 国税庁の定める計算式に基づき、各相続人の控除額を算出する。
    - `控除額 = A × {C / (B - A)} × (D / C) × {(10 - E) / 10}`
    - ただし `A > B` の場合は控除なし。
    - 計算結果はリアルタイムで画面に反映される。

### 4.3. レスポンシブデザイン

- **PC（デスクトップ）:** 横長のレイアウトで、左から右へ時系列（第1次相続 → 第2次相続 → 各相続人）に情報が流れるように表示する。
- **スマートフォン/タブレット:** 画面幅に応じて、各セクションが縦に並ぶレイアウトに自動的に切り替わる。

## 5. 非機能要件

- **パフォーマンス:** 入力値の変更に対する計算結果の反映は、遅延なくリアルタイムに行われること。
- **ユーザビリティ:** 各入力項目には分かりやすいラベルと説明を付与し、ユーザーが迷うことなく操作できるようにする。特に、A, B, C, Dの各金額が何を指すのかを明確に説明する。
- **保守性:** コードはモジュール化され、将来的な機能拡張や税制改正に容易に対応できる構造であること。

## 6. 将来の展望

- 計算結果の保存およびPDF/CSVでのエクスポート機能
- 複数の相続パターンを保存し、比較検討できる機能
- 専門家向けの詳細設定モード 