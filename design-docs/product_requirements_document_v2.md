# 相次相続控除額 計算シミュレーター（家系図表示版）
# 製品要求仕様書 (PRD) v2.0

**文書バージョン:** 2.0  
**作成日:** 2025年6月18日  
**作成者:** Manus AI

## 1. 概要

### 1.1 目的

本アプリケーションは、相次相続控除額を視覚的に理解しやすく計算するためのウェブベースのシミュレーターです。家系図表示と日付入力による経過年数自動計算機能を備え、複数の相続人それぞれの相次相続控除額を計算・表示します。

### 1.2 背景

相次相続控除は、10年以内に発生した2回の相続において、前回の相続で支払った相続税の一部を控除できる制度です。しかし、その計算方法は複雑で、特に複数の相続人がいる場合は理解が難しくなります。本アプリケーションは、視覚的な家系図と自動計算機能により、この複雑な制度をわかりやすく提示することを目指します。

### 1.3 対象ユーザー

- 相続税の申告を控えている個人
- 相続税申告のサポートを行う税理士・会計士
- 相続税制度について学習している学生・専門家
- 相続対策を検討している資産家・その家族

## 2. 機能要件

### 2.1 基本機能

#### 2.1.1 相次相続控除額の計算

- 国税庁の規定に準拠した正確な計算ロジックを実装
- 計算式: A × (C / B) × (D / C) × (10 - E) / 10
  - A: 前回の相続で納めた相続税額
  - B: 前回に取得した財産の価額
  - C: 今回の相続財産の総額
  - D: 相続人が今回取得した財産の価額
  - E: 前回の相続からの経過年数（1年未満切り捨て）
- 計算結果は小数点以下を切り捨て

#### 2.1.2 日付入力による経過年数の自動計算

- 1回目の相続（被相続人の死亡日）の日付入力
- 2回目の相続（今回の被相続人の死亡日）の日付入力
- 上記2つの日付から経過年数を自動計算（1年未満は切り捨て）
- 和暦/西暦両方での入力に対応

#### 2.1.3 家系図の視覚的表示

- 家族関係を視覚的に表示（最大3世代まで）
- 各人物の情報表示（名前、役割、死亡日など）
- 相続状態の表示（死亡、相続放棄、相続欠格など）
- 各相続人の相次相続控除額を家系図上に表示

#### 2.1.4 相続人ごとの情報入力と計算

- 各相続人の基本情報入力（名前、続柄）
- 相続ステータスの選択（法定相続人、死亡、相続放棄、相続欠格、想定外）
- 各相続人が取得した財産額（D）の入力
- 法定相続人の場合のみ相次相続控除額を計算・表示

### 2.2 追加機能

#### 2.2.1 入力支援機能

- 数値の自動フォーマット（3桁区切り）
- 入力値の検証と警告表示
- ツールチップによる各項目の説明表示

#### 2.2.2 データ管理機能

- 入力データの一時保存（ローカルストレージ）
- データのエクスポート/インポート機能（JSON形式）

#### 2.2.3 表示カスタマイズ機能

- 家系図の拡大/縮小
- 表示/非表示の切り替え
- 印刷用レイアウトの提供

## 3. 非機能要件

### 3.1 ユーザビリティ

- 直感的なユーザーインターフェース
- レスポンシブデザイン（PC、タブレット、スマートフォン対応）
- 操作ガイダンスの提供
- エラー時の適切なフィードバック

### 3.2 パフォーマンス

- ページ読み込み時間: 3秒以内
- 入力値変更時の計算・表示更新: 1秒以内
- 家系図描画の最適化

### 3.3 セキュリティ

- 個人情報の非保存（すべてのデータはクライアントサイドのみ）
- XSS対策の実装
- 入力値の適切なサニタイズ

### 3.4 アクセシビリティ

- WCAG 2.1 AA準拠
- キーボード操作のサポート
- スクリーンリーダー対応
- 適切なコントラスト比の確保

### 3.5 互換性

- 主要ブラウザ対応（Chrome, Firefox, Safari, Edge最新版）
- 古いブラウザに対する適切なフォールバック

## 4. 技術要件

### 4.1 開発環境

- フロントエンド: HTML5, CSS3, JavaScript (ES6+)
- フレームワーク: 不使用（純粋なJavaScript）
- ビルドツール: 不要（直接デプロイ可能な静的ファイル）

### 4.2 デプロイ環境

- Vercelにデプロイ可能な静的ウェブサイト
- サーバーサイド処理なし（すべてクライアントサイド）
- CDN活用による高速化

### 4.3 外部ライブラリ

- 家系図描画: SVG.js または D3.js
- 日付処理: Day.js または date-fns
- 数値フォーマット: Intl.NumberFormat API

## 5. デザイン要件

### 5.1 UI/UXデザイン

- モダンでクリーンなデザイン
- 視認性の高い色使い
- 適切な余白とレイアウト
- フォーカスされた要素の明確な表示

### 5.2 家系図デザイン

- 男性: 青系色のアイコン
- 女性: 赤系色のアイコン
- 死亡: アイコンに「×」マーク
- 相続放棄/相続欠格: 適切なマーク表示
- 相次相続控除額: 吹き出し形式で表示

### 5.3 レスポンシブデザイン

- デスクトップ: 横並びレイアウト（入力フォーム + 家系図）
- タブレット: 縦並びレイアウト（入力フォーム → 家系図）
- モバイル: 縦並びレイアウト（タブ切り替え式）

## 6. コンテンツ要件

### 6.1 説明テキスト

- 相次相続控除の概要説明
- 適用条件の説明
- 計算式の解説
- 各入力項目の詳細説明

### 6.2 入力項目の説明

#### A: 前回の相続で納めた相続税額
- 今回の被相続人が前回の相続で実際に納付した相続税額
- 相続税申告書の納付税額を参照

#### B: 前回に取得した財産の価額
- 今回の被相続人が前回の相続で取得した純資産価額
- 相続税申告書の「課税価格」を参照

#### C: 今回の相続財産の総額
- 今回の相続におけるすべての相続人が取得した財産の純資産価額の合計
- 債務控除後の金額

#### D: 相続人が今回取得した財産の価額
- 各相続人が今回の相続で取得した純資産価額
- 債務控除後の金額

#### E: 前回の相続からの経過年数
- 1回目の相続から2回目の相続までの期間（年単位）
- 1年未満の端数は切り捨て
- 日付入力から自動計算

### 6.3 注意事項

- 計算結果は概算であり、正確な税額計算は税理士等の専門家に相談すること
- 税制改正により計算方法が変更される可能性があること
- 特殊なケースでは計算が異なる場合があること

## 7. 制約条件

### 7.1 法的制約

- 税法に準拠した計算ロジック
- 免責事項の明示
- 個人情報非保存の明示

### 7.2 技術的制約

- クライアントサイドのみでの動作
- ブラウザのローカルストレージ容量制限
- SVG描画のブラウザ互換性

## 8. 将来の拡張性

### 8.1 機能拡張

- 複数の相続パターンの比較機能
- 税制改正に対応した計算切り替え機能
- 詳細な相続税申告書の出力機能

### 8.2 技術拡張

- PWA対応によるオフライン機能
- クラウド保存機能（オプション）
- 税理士向けAPI連携

## 9. 成功指標

### 9.1 ユーザー満足度

- 直感的な操作性の実現
- 視覚的な理解のしやすさ
- 計算結果の正確性

### 9.2 技術的指標

- ページ読み込み速度
- 計算処理の応答性
- ブラウザ互換性の確保

## 10. 納品物

### 10.1 コード

- HTML, CSS, JavaScriptファイル一式
- 外部ライブラリ（必要な場合）
- アセットファイル（画像、アイコンなど）

### 10.2 ドキュメント

- 製品要求仕様書（本文書）
- 開発ルール
- ユーザーストーリー
- サイト構造設計書
- 実装ガイド

### 10.3 その他

- Vercelデプロイ用設定ファイル
- README.md（セットアップ手順など）
